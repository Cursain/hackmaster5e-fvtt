{"name":"Inflict Wound","type":"script","author":"YT3vyFbQDsF30XLi","img":"icons/skills/melee/blood-slash-foam-red.webp","scope":"global","command":"if (this.isObsolete(1, \"setWound\")) return false;\n\nconst tokenList = canvas.tokens.controlled;\nif (!tokenList.length) return;\n\nconst dmg = await new Promise(async resolve => {\n    new Dialog({\n        title: game.i18n.localize(\"HM.dialog.setWoundTitle\"),\n        content: await renderTemplate(\"systems/hackmaster5e/templates/dialog/setWound.hbs\"),\n        buttons: {\n            wound: {\n                label: game.i18n.localize(\"HM.dialog.setWoundTitle\"),\n                callback: () => { resolve(parseInt(document.getElementById(\"hp\").value)) }\n            }\n        },\n        default: \"wound\"\n    }).render(true);\n    setTimeout(() => {document.getElementById(\"hp\").focus()}, 10);\n});\n\nif (dmg < 1) return;\nconst woundData = {hp: {value: dmg}, duration: {value: dmg}};\nconst data = {name: \"New Wound\", type: \"wound\", data: woundData};\n\nfor (let i=0; i < tokenList.length; i++) {\n    let actor = tokenList[i].actor;\n    try {\n        await Item.create(data, {parent: actor});\n    } catch (error) {\n        ui.notifications.warn(\"Unable to wound \" + actor.name + \".\");\n        console.error(error);\n        continue;\n    }\n    ui.notifications.info(\"<b>\" + actor.name + \"</b> receives <b>\" + dmg + \" HP</b> of damage.\");\n}","folder":null,"sort":0,"permission":{"default":0,"tCEmHegsCUF698n9":3,"YT3vyFbQDsF30XLi":3},"flags":{"core":{"sourceId":"Macro.XTeusTAXqqPY9MmB"}},"_id":"W6YTvvI1vLx2vSFY"}
