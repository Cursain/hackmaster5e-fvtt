{"name":"Attack","type":"script","author":"YT3vyFbQDsF30XLi","img":"icons/weapons/swords/greatsword-blue.webp","scope":"global","command":"if (this.isObsolete(1, \"getAttack\")) return false;\n\nconst actor = this._hm_getActor();\nif (!actor) return;\nconst actorData = actor.data;\n\nconst weapons = {weapon: actor.data.items.filter((a) => a.type === \"weapon\")};\nconst data = {actor: actor, weapons: weapons};\nconst attackData = await this.dialogmgr.getDialog(\"getAttack\", data);\n\nconst weapon  =  attackData.weapon;\nconst mod     =  attackData.mod;\nconst formula = \"1d20p + @stats.atk.derived.value\"\n\nconst rollmgr = this.rollmgr;\nconst roll    = await rollmgr.getRoll('atk', formula, weapon.data.data, mod);\n\nconst dataset = {'rollType': 'combat', 'rollCombat': 'atk'};\n\nconst chatmgr = this.chatmgr;\nchatmgr.setActor(actor);\nconst card    = await chatmgr.genCard(roll, dataset, weapon.data);\n\nawait ChatMessage.create(card);","folder":null,"sort":0,"permission":{"default":0,"YT3vyFbQDsF30XLi":3},"flags":{"core":{"sourceId":"Macro.1wYLnuQjAlZ5Io0E"}},"_id":"BTiJXanzgTm0uVzl"}
{"name":"Inflict Wound","type":"script","author":"YT3vyFbQDsF30XLi","img":"icons/skills/melee/blood-slash-foam-red.webp","scope":"global","command":"if (this.isObsolete(1, \"setWound\")) return false;\n\nconst actor = this._hm_getActor({allActors: true});\nif (!actor) return;\n\nconst dmg = await this.dialogmgr.getDialog(\"setWound\");\nif (dmg < 1) return;\n\nconst woundData = {hp: {value: dmg}, duration: {value: dmg}};\nconst data = {name: \"New Wound\", type: \"wound\", data: woundData};\n\nfor (let i=0; i < actor.length; i++) {\n    try {\n        await Item.create(data, {parent: actor[i]});\n    } catch (error) {\n        ui.notifications.warn(\"Unable to wound \" + actor[i].name + \".\");\n        console.error(error);\n        continue;\n    }\n    ui.notifications.info(\"<b>\" + actor[i].name + \"</b> receives <b>\" + dmg + \" HP</b> of damage.\");\n}","folder":null,"sort":0,"permission":{"default":0,"tCEmHegsCUF698n9":3,"YT3vyFbQDsF30XLi":3},"flags":{"core":{"sourceId":"Macro.XTeusTAXqqPY9MmB"}},"_id":"DheswACKuPYar3j0"}
